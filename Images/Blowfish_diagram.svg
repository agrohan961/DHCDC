<?xml version="1.0" encoding="utf-8"?>
<svg version="1.1" width="632" height="610" viewBox="0 0 632 610"
	xmlns="http://www.w3.org/2000/svg"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xml:space="preserve"
	xml:lang="en">
<title>Feistel structure of the Blowfish algorithm</title>
<defs>
	<style type="text/css">
		ellipse, line, path, polyline, polygon{
			fill: none;
			stroke: currentColor;
			stroke-width: 1;
		}
		rect{
			fill: #fff;
			stroke: currentColor;
			stroke-width: 1;
		}
		circle{
			fill: currentColor;
		}
		text{
			fill: currentColor;
			font-family: "Liberation Serif", LiberationSerif, CMU Serif, "Times New Roman", Times, serif;
			font-size: 14px;
		}
		.centre { text-anchor: middle; }
		.right  { text-anchor: end; }
		.italic { font-style: italic; }
		.sup    { font-size: 8px; }
		.arrow  { marker-end: url(#arrowhead); }
		.dashes { stroke-dasharray: 3 2; fill: none; }
	</style>

	<!-- Arrowhead -->
	<marker id="arrowhead"
		viewBox="0 0 11 12"
		refX="10"
		refY="6"
		markerWidth="11"
		markerHeight="12"
		markerUnits="userSpaceOnUse"
		orient="auto"
	><polyline points="
		0.3 0.4
		10  6
		0.2 11.6
	"/></marker>
	
	<!-- XOR marker -->
	<g id="xor">
		<line x1="0.5" y1="8.4" x2="16.9" y2="8.4"/>
		<line x1="8.7" y1="0.2" x2="8.7" y2="16.7"/>
		<ellipse cx="8.7" cy="8.6" rx="8.2" ry="8.1"/>
	</g>
	
	<!-- Mod 2^32 marker -->
	<g id="mod">
		<line x1="9.1" y1=".5" x2="9.1" y2="16.8"/>
		<line x1="0.5" y1="8.7" x2="17.7" y2="8.7"/>
		<rect x="0.5" y=".5" width="17.2" height="16.3" style="fill: none"/>
	</g>
</defs>

<g id="graph">
	<g id="input">
		<rect x="20.5" y="20.5" width="502" height="25"/>
		<text x="270" y="37" class="centre">P (64 bits)</text>
	</g>

	<g id="top">
		<polyline points="167,95 167,120 51,120" class="arrow"/>
		<polyline points="41,127.8 41,245.6 500,302.5"/>
		<polyline points="501.6,193 501.6,245.4 42,302.6"/>
		<line class="arrow" x1="41"  y1="45.5"  x2="41"    y2="109.9"/>
		<line class="arrow" x1="41"  y1="184.2" x2="92.8"  y2="184.2"/>
		<line class="arrow" x1="501" y1="46.1"  x2="501"   y2="175.3"/>
		<line class="arrow" x1="397" y1="184.2" x2="490.3" y2="184.2"/>
		<use xlink:href="#xor" x="33"  y="111"/>
		<use xlink:href="#xor" x="493" y="176"/>
		<text x="51"  y="77">L</text>
		<text x="152" y="91" class="right">K<tspan class="italic">r</tspan></text>
		<text x="486" y="77" class="right">R</text>
		
		<g id="f-function">
			<rect x="100.5" y="136.5" width="296.3" height="97" class="dashes"/>
			<text x="257" y="131" class="centre">F-Function</text>
			
			<!-- Left margin -->
			<polyline class="arrow" points="121.5,184.5 121.5,148 160,148"/>
			<polyline class="arrow" points="121.5,184.5 121.5,221 160,221"/>
			<line class="arrow" x1="121.5" y1="172.2" x2="159.8" y2="172.2"/>
			<line class="arrow" x1="121.5" y1="196.2" x2="159.8" y2="196.2"/>
			
			<!-- Right margin -->
			<polyline points="250.2,148.6 313.4,148.6 313.4,164.7"/>
			<polyline points="321.7,172.2 342.8,172.2 342.8,189.2"/>
			<polyline points="350.8,196.9 371.6,196.9 371.6,213.9"/>
			<line x1="250.2" y1="172.2" x2="304.5" y2="172.2"/>
			<line x1="250.2" y1="196.9" x2="334.3" y2="196.9"/>
			<line x1="250.2" y1="221.5" x2="363"   y2="221.5"/>
			<use xlink:href="#xor" x="334"   y="188"/>
			<use xlink:href="#mod" x="304.5" y="163.5"/>
			<use xlink:href="#mod" x="363"   y="212.5"/>
			
			<!-- Text boxes -->
			<g id="sbox-0">
				<rect x="162.7" y="140.5" width="87.5" height="15.8"/>
				<text x="206" y="152" class="centre">S-box 0</text>
			</g>
			<g id="sbox-1">
				<rect x="162.7" y="164.5" width="87.5" height="15.8"/>
				<text x="206" y="176" class="centre">S-box 1</text>
			</g>
			<g id="sbox-2">
				<rect x="162.7" y="188.5" width="87.5" height="16.6"/>
				<text x="206" y="201" class="centre">S-box 2</text>
			</g>
			<g id="sbox-3">
				<rect x="162.7" y="213.5" width="87.5" height="15.7"/>
				<text x="206" y="225" class="centre">S-box 3</text>
			</g>
		</g>
	</g>

	<g id="continuation">
		<title>â‹®</title>
		<circle cx="270" cy="330" r="1.2"/>
		<circle cx="270" cy="342" r="1.2"/>
		<circle cx="270" cy="354" r="1.2"/>
	</g>

	<g id="bottom">
		<polyline class="arrow" points="41.5,380.8 501.2,421.5 501.2,454"/>
		<polyline class="arrow" points="500.3,380.4 41.3,421.4 41.3,454"/>
		<line class="arrow" x1="41"  y1="471" x2="41"  y2="505"/>
		<line class="arrow" x1="171" y1="463" x2="51"  y2="463"/>
		<line class="arrow" x1="403" y1="464" x2="491" y2="464"/>
		<line class="arrow" x1="501" y1="472" x2="501" y2="505"/>
		<use xlink:href="#xor" y="455" x="33"/>
		<use xlink:href="#xor" y="455" x="492.5"/>
		<text x="173" y="464" class="left">K18</text>
		<text x="403" y="461" class="right">K17</text>
	</g>
	
	<g id="output">
		<rect x="20.5" y="506.5" width="502" height="20"/>
		<text x="270" y="521" class="centre">C (64 bits)</text>
	</g>
</g>

<g id="sidebar">
	<g>
		<polyline points="530.8,61.7 543.4,61.7 543.4,307 530.8,307"/>
		<text x="553" y="148">one round</text>
	</g>
	<g>
		<polyline points="530.8,322.7 543.4,322.7 543.4,363 530.8,363"/>
		<text x="0"><!--
			--><tspan x="553" y="341">15 more</tspan><!--
			--><tspan x="553" y="355">rounds</tspan><!--
		--></text>
	</g>
	<g>
		<polyline points="530.8,380.7 543.4,380.7 543.4,416.5 531.8,416.5"/>
		<text x="0"><!--
			--><tspan x="554" y="395">undo last</tspan><!--
			--><tspan x="554" y="409">swap</tspan><!--
		--></text>
	</g>
	<g>
		<polyline points="530.8,421.7 543.4,421.7 543.4,482.5 530.8,482.5"/>
		<text x="0"><!--
			--><tspan x="553" y="441">output</tspan><!--
			--><tspan x="553" y="455">whitening</tspan><!--
		--></text>
	</g>
</g>

<g id="legend">
	<use xlink:href="#xor" x="120.5" y="572.5"/>
	<use xlink:href="#mod" x="288.5" y="572.5"/>
	<text x="120" y="564">P=Plaintext;  C=Ciphertext;   K<tspan class="italic">x</tspan> = P-array-entry <tspan class="italic">x</tspan></text>
	<text x="144" y="585">= xor</text>
	<text x="313" y="585">= addition mod 2<tspan class="sup" dy="-4.5">^</tspan><tspan dy="4.5">32</tspan></text>
</g>
</svg>
